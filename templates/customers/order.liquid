{%- assign order_subtitle = 'customer.account.title' | t -%}
{%- assign order_title = 'customer.order.title' | t: name: order.name -%}
{%- assign date_format = 'date_formats.long' | t -%}
{%- assign published_at = order.created_at | date: date_format -%}

{%- capture content_html -%}
	<div class="section__meta">
		<span>{{ published_at }}</span>
	</div><!-- /.section__meta -->
{%- endcapture -%}

{%- render 'section-triangles-top' section_subtitle: order_subtitle, section_title: order_title, section_modifier: 'section--triangles-secondary section--order', section_content: content_html, section_entry: true -%}

<section class="section-default section-default--order">
	<div class="shell">
		<div class="section__body">
			<div class="section__content">
				{% if order.cancelled %}
					<div class="order-notice">
						{%- assign date_format = 'date_formats.long' | t -%}
						{%- assign cancelled_at = order.cancelled_at | date: date_format -%}

						<p class="order-notice__date">{{- 'customer.order.cancelled' | t: date: cancelled_at -}}</p>

						<p class="order-notice__reason">{{- 'customer.order.cancelled_reason' | t: reason: order.cancel_reason -}}</p>
					</div><!-- /.order-notice -->
				{% endif %}

				<div class="table table--mobile-primary table--order">
					<table>
						<thead>
							<tr class="order">
								<th class="order__product">
									{{- 'customer.order.product' | t -}}
								</th>

								<th class="order__sku">
									{{- 'customer.order.sku' | t -}}
								</th>

								<th class="order__price">
									{{- 'customer.order.price' | t -}}
								</th>

								<th class="order__quantity">
									{{- 'customer.order.quantity' | t -}}
								</th>

								<th class="order__total">
									{{- 'customer.order.total' | t -}}
								</th>
							</tr>
						</thead>

						<tbody>
							{% for line_item in order.line_items %}
								<tr class="order" id="{{- line_item.id -}}">
									<td
										class="order__product"
										data-heading="{{- 'customer.order.product' | t -}}"
									>

										{{- line_item.title | link_to: line_item.product.url -}}

										{% if line_item.fulfillment %}
											<div class="order__note">
												{%- assign date_format = 'date_formats.short' | t -%}

												{% assign created_at = line_item.fulfillment.created_at | date: date_format %}

												{{- 'customer.order.fulfilled_at' | t: date: created_at -}}

												{% if line_item.fulfillment.tracking_number %}
													<a href="{{- line_item.fulfillment.tracking_url -}}">
														{{- line_item.fulfillment.tracking_company -}} #{{- line_item.fulfillment.tracking_number -}}
													</a>
												{% endif %}
											</div>
										{% endif %}
									</td>

									<td
										class="order__sku"
										data-heading="{{- 'customer.order.sku' | t -}}"
									>
										{{- line_item.sku -}}
									</td>

									<td
										class="order__price"
										data-heading="{{- 'customer.order.price' | t -}}"
									>
										{{- line_item.price | money -}}
									</td>

									<td
										class="order__quantity"
										data-heading="{{- 'customer.order.quantity' | t -}}"
									>
										{{- line_item.quantity -}}
									</td>

									<td
										class="order__total"
										data-heading="{{- 'customer.order.total' | t -}}"
									>
										{{- line_item.quantity | times: line_item.price | money -}}
									</td>
								</tr>
							{% endfor %}
						</tbody>

						<tfoot class="order-details">
							<tr class="order-details__subtotal">
								<td class="order-details__title hidden-xs" colspan="4">
									{{- 'customer.order.subtotal' | t -}}
								</td>

								<td class="order-details__value" data-heading="{{- 'customer.order.subtotal' | t -}}">
									{{- order.subtotal_price | money -}}
								</td>
							</tr>

							{% for discount in order.discounts %}
								{%- assign discount_code_string = 'customer.order.discount' | t -%}
								{%- assign discount_code_title = discount.code | append: ' ' | append: discount_code_string -%}
								<tr class="order-details__discount">
									<td class="order-details__title hidden-xs" colspan="4">
										{{ discount_code_title }}
									</td>

									<td class="order-details__value" data-heading="{{ discount_code_title }}">
										{{- discount.savings | money -}}
									</td>
								</tr>
							{% endfor %}

							{% for shipping_method in order.shipping_methods %}
								{%- assign shipping_method_string = 'customer.order.shipping' | t -%}
								{%- assign shipping_method_title = shipping_method_string | append: ' (' | append: shipping_method.title | append: ')' -%}

								<tr class="order-details__shipping">
									<td class="order-details__title hidden-xs" colspan="4">
										{{ shipping_method_title }}
									</td>

									<td class="order-details__value" data-heading="{{ shipping_method_title }}">
										{{- shipping_method.price | money -}}
									</td>
								</tr>
							{% endfor %}

							{% for tax_line in order.tax_lines %}
								{%- assign tax_line_string = 'customer.order.tax' | t -%}
								{%- assign tax_line_rate = tax_line.rate | times: 100 -%}
								{%- assign tax_line_title = tax_line_string | append: ' (' | append: tax_line.title | append: ' ' | append: tax_line_rate | append: '%)' -%}

								<tr class="order-details__tax">
									<td class="order-details__title hidden-xs" colspan="4">
										{{ tax_line_title }}
									</td>

									<td class="order-details__value" data-heading="{{ tax_line_title }}">
										{{- tax_line.price | money -}}
									</td>
								</tr>
							{% endfor %}

							<tr class="order-details__total">
								<td class="order-details__title hidden-xs" colspan="4">
									{{- 'customer.order.total' | t -}}
								</td>

								<td class="order-details__value" data-heading="{{- 'customer.order.total' | t -}}">
									{{- order.total_price | money -}}
								</td>
							</tr>
						</tfoot>
					</table>
				</div><!-- /.table -->

				<div class="table table--order-info">
					<table>
						<thead>
							<tr>
								<th>
									<h4>
										{{- 'customer.order.billing_address' | t -}}
									</h4>
								</th>

								<th>
									<h4>
										{{- 'customer.order.shipping_address' | t -}}
									</h4>
								</th>
							</tr>
						</thead>

						<tbody>
							<tr>
								<td data-heading="{{- 'customer.order.billing_address' | t -}}">
									<p>
										<strong>{{ 'customer.order.payment_status' | t }}:</strong> {{ order.financial_status_label }}
									</p>
								</td>

								<td data-heading="{{- 'customer.order.shipping_address' | t -}}">
									<p>
										<strong>{{ 'customer.order.fulfillment_status' | t }}:</strong> {{ order.fulfillment_status_label }}
									</p>
								</td>
							</tr>

							<tr>
								<td data-heading="{{- 'customer.order.billing_address' | t -}}">
									<p>
										{{- order.billing_address | format_address -}}
									</p>
								</td>

								<td data-heading="{{- 'customer.order.shipping_address' | t -}}">
									<p>
										{{- order.shipping_address | format_address -}}
									</p>
								</td>
							</tr>
						</tbody>
					</table>
				</div><!-- /.table -->
			</div><!-- /.section__content -->
		</div><!-- /.section__body -->
	</div><!-- /.shell -->
</section><!-- /.section-account -->
