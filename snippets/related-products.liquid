{%- assign _collection = collection | default: product.collections[0] -%}
{%- assign product_items = '' -%}

{% if _collection != blank %}
  {%- assign related_snippet = snippet | default: 'product-item' -%}
  {%- assign related_items_to_show = items_to_show | default: 4 -%}
  {%- assign related_classes = class | default: 'related-products' -%}
  {%- assign related_counter = 0 -%}

  {% for _product in _collection.products %}
  


    {%- if _product.id == product.id -%}
      {%- continue -%}
    {%- endif -%}

    {%- assign related_counter = related_counter | plus: 1 -%}

    {%- capture product_items -%}
      {{ product_items }}
	
      {% render 'product-item' _product: _product, modifier: 'product-item--default product-items__item' %}
    {%- endcapture -%}

    {%- if related_counter >= related_items_to_show -%}
      {% break %}
    {%- endif -%}
  {% endfor %}
{% endif %}

{%- if product_items != '' -%}
<section class="section-default section-default--related">
  <div class="shell">
    <header class="section__head">
      <h4 class="section__title h4 h4--mobile-small">{{ 'products.product.related_title' | t }}</h4><!-- /.section__title -->
    </header><!-- /.section__head -->
    <div class="section__body">
      <div class="product-items product-items--secondary">
        {{ product_items }}
      </div><!-- /.product-items -->
    </div><!-- /.section__body -->
  </div><!-- /.shell -->
</section><!-- /.section-default -->
{%- endif -%}
